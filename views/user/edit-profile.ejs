<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>
        User Profile </title>

    <!-- Fontfaces CSS-->
    <link href="/public/css/font-face.css" rel="stylesheet" media="all">
    <link href="/public/css/edit-profile.css" rel="stylesheet" media="all">
    <link href="/public/vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="/public/vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="/public/vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Bootstrap CSS-->
    <link href="/public/vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="/public/vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="/public/vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="/public/vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="/public/vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="/public/vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="/public/vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="/public/vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="/public/css/theme.css" rel="stylesheet" media="all">
    <link href="/public/css/style.css" rel="stylesheet" media="all">
    <link href="/public/css/styles.css" rel="stylesheet" media="all">
    <link href="/public/css/styless.css" rel="stylesheet" media="all">

    <style>
        /* Header styles */
    </style>
</head>

<body class="animsition">
    <div class="page-wrapper">
        <header class="header-desktop">
            <div class="section__content section__content--p30">
                <div class="container-fluid">
                    <div class="header-wrap d-flex justify-content-between align-items-center">
                        <div class="logo">
                            <a href="/">
                                <img src="/public/images/icon/logo.png" alt="Cool Admin" />
                            </a>

                        </div>
                        <!-- Navigation Menu -->
                        <nav class="nav-header">

                            <ul class="nav">

                                <li class="nav-item">
                                    <a href="/" class="nav-link">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a href="/about" class="nav-link">About</a>
                                </li>
                                <li class="nav-item">
                                    <a href="/contact" class="nav-link">Contact Us</a>
                                </li>
                            </ul>
                        </nav>

                        <!-- User Actions and Notifications -->
                        <% if (user) { %>
                            <!-- If user exists -->
                            <% if (user.role === 'user') { %>
                                <!-- User is a 'user', show notifications and account -->
                                <div class="header-button d-flex align-items-center">
                                    <!-- Notifications -->
                                    <div class="noti-wrap me-4">
                                        <div class="noti__item js-item-menu">
                                            <i class="zmdi zmdi-notifications"></i>
                                            <span class="quantity"><%= notifications.length %></span>

                                            <div class="notifi-dropdown js-dropdown">
                                                <div class="notifi__title d-flex justify-content-between align-items-center">
                                                    <p>You have
                                                        <%= notifications.length %> Notifications</p>

                                                    <!-- Conditionally render "Mark All as Read" if there are notifications -->
                                                    <% if (notifications.length > 0) { %>
                                                        <a href="#" class="mark-as-read" id="markAllRead" style="font-size: 12px; text-decoration: none; color: #007bff;">Mark All as Read</a>
                                                        <% } %>
                                                </div>

                                                <!-- Conditionally render notification items or show a message if there are no notifications -->
                                                <% if (notifications.length > 0) { %>
                                                    <% notifications.forEach(notification => { %>
                                                        <div class="notifi__item">
                                                            <div class="bg-c1 img-cir img-40">
                                                                <i class="zmdi zmdi-file-text"></i>
                                                            </div>
                                                            <div class="content">
                                                                <p>
                                                                    <%= notification.message %>
                                                                </p>
                                                                <span class="date">
                                                                    <%= new Date(notification.createdAt).toLocaleDateString('en-US', {
                                                                        day: '2-digit',
                                                                        month: 'short',
                                                                        year: 'numeric'
                                                                    }) %> at 
                                                                    <%= new Date(notification.createdAt).toLocaleTimeString('en-US', {
                                                                        hour: '2-digit',
                                                                        minute: '2-digit',
                                                                        hour12: true
                                                                    }) %>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <% }) %>
                                                            <% } else { %>
                                                                <div class="no-notifications">
                                                                    <p>No new notifications</p>
                                                                </div>
                                                                <% } %>

                                                                    <div class="notifi__footer">
                                                                        <a href="#">All notifications</a>
                                                                    </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Account Dropdown -->
                                    <div class="account-wrap">
                                        <div class="account-item clearfix js-item-menu">
                                            <div class="image">
                                                <img src="media/<%= user.image %>" alt="<%= user.first_name %>" style="width: 35px; height: 35px; padding: 0px;" />
                                            </div>
                                            <div class="content">
                                                <a class="js-acc-btn" href="">
                                                    <%= user.first_name %>
                                                </a>
                                            </div>
                                            <div class="account-dropdown js-dropdown">
                                                <div class="info clearfix">
                                                    <div class="image">
                                                        <a href="/profile">
                                                            <img src="media/<%= user.image %>" alt="<%= user.first_name %>" />
                                                        </a>
                                                    </div>
                                                    <div class="content">
                                                        <h5 class="name">
                                                            <a href="#">
                                                                <%= user.first_name %>
                                                            </a>
                                                        </h5>
                                                        <span class="email"><%= user.email %></span>
                                                    </div>
                                                </div>
                                                <div class="account-dropdown__footer">
                                                    <a href="/logout">
                                                        <i class="zmdi zmdi-power"></i>Logout</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <% } else if (user.role === 'admin') { %>
                                    <!-- User is an 'admin', show only logout -->
                                    <div class="account-wrap">
                                        <div class="account-item clearfix js-item-menu">
                                            <div class="image">
                                                <img src="media/<%= user.image %>" alt="<%= user.first_name %>" style="width: 35px; height: 35px; padding: 0px; " />
                                            </div>
                                            <div class="content">
                                                <a class="js-acc-btn" href="">
                                                    <%= user.first_name %>
                                                </a>
                                            </div>
                                            <div class="account-dropdown js-dropdown">
                                                <div class="info clearfix">
                                                    <div class="image">
                                                        <a href="/profile">
                                                            <img src="media/<%= user.image %>" alt="<%= user.first_name %>" />
                                                        </a>
                                                    </div>
                                                    <div class="content">
                                                        <h5 class="name">
                                                            <a href="#">
                                                                <%= user.first_name %>
                                                            </a>
                                                        </h5>
                                                        <span class="email"><%= user.email %></span>
                                                    </div>
                                                </div>
                                                <div class="account-dropdown__body">
                                                    <div class="account-dropdown__item">
                                                        <a href="">
                                                            <i class="zmdi zmdi-account"></i>Account</a>
                                                    </div>


                                                </div>

                                                <% } %>

                                                    <% } else { %>
                                                        <!-- User is not logged in, show login and register links -->
                                                        <div class="user-actions d-flex">
                                                            <a href="/login" class="nav-link" style="text-decoration: none; list-style: none; color: #333; font-weight: 500;">Login</a>
                                                            <a href="/register" class="nav-link" style="text-decoration: none; list-style: none; color: #333; font-weight: 500;">Register</a>
                                                        </div>
                                                        <% } %>
                                            </div>
                                        </div>
                                    </div>
        </header>
        <!-- END PAGE CONTAINER-->


        <div class="main-content" style="overflow-y: auto;  ">
            <div class="container">
                <!-- Back Button and Profile Picture Section -->


                <div class="row">
                    <div class="col-xl-12">
                        <!-- Account details card-->
                        <div class="card mb-4">
                            <div class="card-header">Personal Details</div>
                            <div class="card-body">

                                <form action="/personal_details" method="post" novalidate>
                                    <!-- Form Group (About Me)-->
                                    <div class="mb-3">
                                        <label class="small mb-1" for="inputAbout">About Me</label>
                                        <textarea rows="4" class="form-control" id="inputAbout" name="about"><%= user.personalDetails ? user.personalDetails.about : '' %></textarea>
                                    </div>
                                    <!-- Form Row-->
                                    <div class="row gx-3 mb-3">
                                        <!-- Form Group (First Name)-->
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputFirstName">First Name:</label>
                                            <input class="form-control" id="" type="text" value="<%= user.first_name %>" name="first_name">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputLastName">Last Name:</label>
                                            <input class="form-control" id="inputLastName" type="text" value="<%= user.last_name %>" name="last_name">
                                        </div>
                                    </div>

                                    <!-- Form Group (Email)-->
                                    <div class="mb-3 row gx-3">
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputFatherName">Father Name:</label>
                                            <input class="form-control" id="inputFatherName" type="text" value="<%= user.personalDetails ? user.personalDetails.father_name : '' %>" name="father_name">

                                        </div>
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputWebsite">Website: (Optional)</label>
                                            <input class="form-control" id="inputWebsite" type="url" name="website" value="<%= user.personalDetails ? user.personalDetails.website : '' %>">
                                        </div>
                                    </div>
                                    <input class="form-control" id="userId" type="hidden" value="<%= user._id %>" name="user_id">

                                    <!-- Form Row -->
                                    <div class="row gx-3 mb-3">
                                        <!-- Form Group (Education)-->
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputEducation">Education:</label>
                                            <input class="form-control" id="inputEducation" type="text" placeholder="Enter Your Education" name="education" value="<%= user.personalDetails ? user.personalDetails.education : '' %>">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputPosition">Position:</label>
                                            <input class="form-control" id="inputPosition" type="text" name="position" placeholder="Enter Your Position in Company" value="<%= user.personalDetails ? user.personalDetails.position : '' %>">
                                        </div>
                                    </div>

                                    <!-- Form Row -->
                                    <div class="row gx-3 mb-3">
                                        <!-- Form Group (City)-->
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputCity">City:</label>
                                            <input class="form-control" id="inputCity" type="text" placeholder="Enter Your City" name="city" value="<%= user.personalDetails ? user.personalDetails.city : '' %>">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputZipCode">Zip Code:</label>
                                            <input class="form-control" id="inputZipCode" type="number" name="zip_code" placeholder="Enter Your Zip Code" value="<%= user.personalDetails ? user.personalDetails.zip_code : '' %>">
                                        </div>
                                    </div>

                                    <!-- Form Group (Address)-->
                                    <div class="mb-3">
                                        <label class="small mb-1" for="inputAddress">Address:</label>
                                        <input class="form-control" id="inputAddress" type="text" name="address" value="<%= user.personalDetails ? user.personalDetails.address : '' %>">
                                    </div>

                                    <!-- Form Row -->
                                    <div class="row gx-3 mb-3">
                                        <!-- Form Group (Phone Number)-->
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputPhone">Phone number:</label>
                                            <input class="form-control" id="inputPhone" type="tel" name="phone_no" placeholder="Enter Your Phone Number" value="<%= user.personalDetails ? user.personalDetails.phone_no : '' %>">
                                        </div>
                                        <!-- Form Group (Birthday)-->
                                        <div class="col-md-6">
                                            <label class="small mb-1" for="inputBirthday">Birthday:</label>
                                            <input class="form-control" id="inputBirthday" type="date" name="dob" placeholder="Select Your DOB" value="<%= user.personalDetails && user.personalDetails.dob ? user.personalDetails.dob.toISOString().split('T')[0] : '' %>">
                                        </div>

                                    </div>

                                    <!-- Form Group (Website)-->
                                    <div class="mb-3">
                                        <label class="small mb-1" for="inputWebsite">Website: (Optional)</label>
                                        <input class="form-control" id="inputWebsite" type="url" name="website" value="<%= user.personalDetails ? user.personalDetails.website : '' %>">
                                    </div>

                                    <!-- Save changes button-->
                                    <input class="btn btn-primary" type="submit" value="Save Changes">
                                </form>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- Jquery JS-->
        <script src="/public/vendor/jquery-3.2.1.min.js"></script>
        <!-- Bootstrap JS-->
        <script src="/public/vendor/bootstrap-4.1/popper.min.js"></script>
        <script src="/public/vendor/bootstrap-4.1/bootstrap.min.js"></script>
        <!-- Vendor JS -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

        <script src="/public/vendor/slick/slick.min.js"></script>
        <script src="/public/vendor/wow/wow.min.js"></script>
        <script src="/public/vendor/animsition/animsition.min.js"></script>
        <script src="/public/vendor/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
        <script src="/public/vendor/counter-up/jquery.waypoints.min.js"></script>
        <script src="/public/vendor/counter-up/jquery.counterup.min.js"></script>
        <script src="/public/vendor/circle-progress/circle-progress.min.js"></script>
        <script src="/public/vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
        <script src="/public/vendor/chartjs/Chart.bundle.min.js"></script>
        <script src="/public/vendor/select2/select2.min.js"></script>

        <!-- Main JS-->
        <script src="/public/js/main.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var myModal = new bootstrap.Modal(document.getElementById('changeProfilePictureModal'), {
                    keyboard: false
                });
            });
        </script>
        <script>
            document.getElementById('markAllRead').addEventListener('click', function(e) {
                e.preventDefault();

                // AJAX request to mark all notifications as read
                $.ajax({
                    url: '/notifications/mark-all-read',
                    type: 'POST',
                    success: function(response) {
                        // Update the notification count and reload the notification list

                        location.reload(); // Reload the page or update the notifications via JS
                    },
                    error: function(error) {
                        console.error('Error marking notifications as read', error);
                    }
                });
            });
        </script>
</body>

</html>
<!-- end document -->